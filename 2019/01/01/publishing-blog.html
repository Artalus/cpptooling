<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.5.0 -->
<title>Publishing Jekyll blog on Github Pages via Travis CI | c++ tooling cookbook</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="Publishing Jekyll blog on Github Pages via Travis CI" />
<meta name="author" content="Artalus" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="This is a short story about me trying to get this blog working on 1 January. Yeah, it is unrelated to C++ for approx. 99.9%. But it took so stupidly much time, I thought it might be worth to be immortalized here." />
<meta property="og:description" content="This is a short story about me trying to get this blog working on 1 January. Yeah, it is unrelated to C++ for approx. 99.9%. But it took so stupidly much time, I thought it might be worth to be immortalized here." />
<link rel="canonical" href="https://artalus.github.io/cpptooling/2019/01/01/publishing-blog.html" />
<meta property="og:url" content="https://artalus.github.io/cpptooling/2019/01/01/publishing-blog.html" />
<meta property="og:site_name" content="c++ tooling cookbook" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2019-01-01T13:52:00+00:00" />
<script type="application/ld+json">
{"description":"This is a short story about me trying to get this blog working on 1 January. Yeah, it is unrelated to C++ for approx. 99.9%. But it took so stupidly much time, I thought it might be worth to be immortalized here.","author":{"@type":"Person","name":"Artalus"},"@type":"BlogPosting","url":"https://artalus.github.io/cpptooling/2019/01/01/publishing-blog.html","headline":"Publishing Jekyll blog on Github Pages via Travis CI","dateModified":"2019-01-01T13:52:00+00:00","datePublished":"2019-01-01T13:52:00+00:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://artalus.github.io/cpptooling/2019/01/01/publishing-blog.html"},"@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/cpptooling/assets/main.css"><link type="application/atom+xml" rel="alternate" href="https://artalus.github.io/cpptooling/feed.xml" title="c++ tooling cookbook" /></head>
<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-home" href="/cpptooling/">
        <img  class="site-avatar" src="/cpptooling/assets/site/avatar.svg" />
        <span class="site-title">c++ tooling cookbook</span>
      </a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/cpptooling/about/">About</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Publishing Jekyll blog on Github Pages via Travis CI</h1>
    
<p class="post-meta">
    <time class="dt-published" datetime="2019-01-01T13:52:00+00:00" itemprop="datePublished">Jan 1, 2019
    </time>• <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <span class="p-author h-card" itemprop="name">
                Artalus
            </span>
        </span> • <span class="tags"><a href="/cpptooling/tags/not-cpp/"> #not-cpp</a> <a href="/cpptooling/tags/blog/"> #blog</a></span>
</p>

  </header><div class="tldr"><h5>TL;DR</h5><p>
    Writing Jekyll stuff is fun. But GitHub Pages do not support any Ruby programming. You have to integrate your static site repo with Travis CI and publish generated contents from there. ...And then you spend all your daylight hours trying to fix a single line

    </p></div><div class="post-content e-content" itemprop="articleBody">
    <p>Writing Jekyll was kinda fun and unusual experience. The <a href="https://jekyllrb.com/docs/">official docs</a> are okay, if a bit scarce. I advice to immediately copy your theme files from <code class="highlighter-rouge">~/.gem/ruby/2.5.0/gems/minima-2.5.0/{_includes,_layouts}</code> to your blog repo for the ease of modifying the default behavior.</p>

<p>Surprisingly, while being blog-aware, Jekyll (or rather, its default theme “minima”) does not provide any means for displaying your posts tags, so I ended up combining <a href="https://dev.to/rpalo/jekyll-tags-the-easy-way">these</a> <a href="http://charliepark.org/tags-in-jekyll">two</a> solutions to generate list of tags for each post and a page listing all posts with this tag. A lot of duplicated code could be reduced by introducing custom <a href="https://jekyllrb.com/docs/plugins/tags/">{<code class="highlighter-rouge">% tag %</code>}s</a> and <a href="https://jekyllrb.com/docs/includes/">{<code class="highlighter-rouge">% include %</code>}s</a>. Which, however, led to a small problem.</p>

<p>Turns out – those “GitHub Pages do not support Jekyll plugins” I stumbled upon couple of times, meant not only third-party Jekyll-related Ruby (packages), but even 10-20 line Ruby snippets in <code class="highlighter-rouge">_plugins</code> folder that implement my custom tags like {<code class="highlighter-rouge">% taglist %</code>} or {<code class="highlighter-rouge">% tldr %</code>}! <em>“Outrageous!”</em>, thought I, and resorted to publishing the site via <a href="https://travis-ci.org">Travis CI</a> service. Why Travis? Because I had some experience using it and it seemed to be best integrated with GitHub.</p>

<p>I quickly googled several solutions involving <code class="highlighter-rouge">bundle install; jekyll build; git checkout gh-pages; rm -rf; git push</code>, but the idea of completely automated publishing without any scripts was so prevalent, I finally stumbled upon <a href="https://medium.com/@mcred/supercharge-github-pages-with-jekyll-and-travis-ci-699bc0bde075">this beauty</a>:</p>

<figure class="highlight"><pre><code class="language-yaml" data-lang="yaml"><span class="na">language</span><span class="pi">:</span> <span class="s">ruby</span>
<span class="na">script</span><span class="pi">:</span>
<span class="pi">-</span> <span class="s">JEKYLL_ENV=production bundle exec jekyll build</span>
<span class="na">env</span><span class="pi">:</span>
  <span class="na">global</span><span class="pi">:</span>
  <span class="c1"># encrypted GH_TOKEN</span>
  <span class="pi">-</span> <span class="na">secure</span><span class="pi">:</span> <span class="s">p9vtzE9II1 ...</span>
<span class="na">branches</span><span class="pi">:</span>
  <span class="na">only</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s">master</span>
<span class="na">deploy</span><span class="pi">:</span>
  <span class="na">provider</span><span class="pi">:</span> <span class="s">pages</span>
  <span class="na">local-dir</span><span class="pi">:</span> <span class="s2">"</span><span class="s">./_site"</span>
  <span class="na">target-branch</span><span class="pi">:</span> <span class="s">gh-pages</span>
  <span class="na">skip-cleanup</span><span class="pi">:</span> <span class="no">true</span>
  <span class="na">github-token</span><span class="pi">:</span> <span class="s2">"</span><span class="s">$GH_TOKEN"</span>
  <span class="na">keep-history</span><span class="pi">:</span> <span class="no">true</span>
  <span class="na">on</span><span class="pi">:</span>
    <span class="na">branch</span><span class="pi">:</span> <span class="s">master</span></code></pre></figure>

<p>I love when instead of bash script I can describe policy for doing stuff in declarative way. Don’t you? So I happily put it into <code class="highlighter-rouge">.travis.yml</code>. It was about 11:30 AM.</p>

<p>I got very descriptive error message:</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ bundle install
Fetching gem metadata from https://rubygems.org/...........
Resolving dependencies...
Bundler could not find compatible versions for gem "safe_yaml":
  In Gemfile:
    jekyll (~&gt; 3.8.4) was resolved to 3.8.5, which depends on safe_yaml (~&gt; 1.0)
</code></pre></div></div>
<p>Since I saw Ruby for the first time last evening, it left me completely dumbfounded. Especially since, guess what? It works on my machine. And the gem (Ruby term for package) was actually present in repositories in more than one version, including the <code class="highlighter-rouge">1.0</code> mentioned and <code class="highlighter-rouge">1.0.4</code> installed locally.</p>

<p>Skipping the whole story, I tried switching Jekyll versions, Bundler versions, Ruby versions, Ruby virtual machines, updating everything Ruby-related that could be updated, updating everything in multiple ways… Then I gave up, created a separate repository consisting of <code class="highlighter-rouge">jenkins new .</code> and tried to publish it via Travis. It failed too!</p>

<p>I gave up one more time and went to Ruby chat in Telegram to ask <em>“WTF?”</em>. Wise Ruby gods had mercy on me and said, <em>“Remove Gemfile.lock from .gitignore”</em>.</p>

<p>…</p>

<p>What?.. But I did as was told, pushed changes to GH, and Travis installed everything correctly, and the example project was published and working.</p>

<p>So I voiced my concern, <em>“What?”</em>.</p>

<p>And the gods replied, <em>“Dunno lol <code class="highlighter-rouge">¯\_(ツ)_/¯</code>“</em>. And there was morning, and there was evening, about 15:30.</p>

<p>But doing this for my blog repo did nothing. So I wrote to Travis Support, frustrated a bit, gave up one more time and started comparing two projects symbol by symbol. Turned out, in my blog’s <code class="highlighter-rouge">Gemfile</code> I had simply <code class="highlighter-rouge">gem "minima"</code>, while the example’s <code class="highlighter-rouge">Gemfile</code> had <code class="highlighter-rouge">gem "minima", "~&gt; 2.0"</code>. So I changed it in my <code class="highlighter-rouge">Gemfile</code>, and Travis installed everything correctly, and the blog was published. And there was evening, and there was even more evening, about 16:30.</p>

<p>…</p>

<p>So I voiced my concern one more time and went to writing this post and finished it in about an hour, or hour and half.</p>

<p>…</p>

<p>look, ma, im’ma blogier nau!</p>

<hr />

<p>_edit 10.01.2019: according to email exchange with Travis Support, the problem was likely caused by Bundler 1.17.3 released on December 26th. It was later updated to 2.0.1, which likely fixed the problem, since I could not reproduce the issue anymore. I do not know, however, why the issue never occured to my local installation, since I also had 1.17.3 installed.</p>

  </div><div id="disqus_thread"></div>
  <script>
    var disqus_config = function () {
      this.page.url = 'https://artalus.github.io/cpptooling/2019/01/01/publishing-blog.html';
      this.page.identifier = 'https://artalus.github.io/cpptooling/2019/01/01/publishing-blog.html';
    };

    (function() {
      var d = document, s = d.createElement('script');

      s.src = 'https://cpptooling.disqus.com/embed.js';

      s.setAttribute('data-timestamp', +new Date());
      (d.head || d.body).appendChild(s);
    })();
  </script>
  <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript><a class="u-url" href="/cpptooling/2019/01/01/publishing-blog.html" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/cpptooling/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">c++ tooling cookbook</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name"></li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/Artalus"><svg class="svg-icon"><use xlink:href="/cpptooling/assets/minima-social-icons.svg#github"></use></svg> <span class="username">Artalus</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>Various stuff related to the ecosystem around C++ language</p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
